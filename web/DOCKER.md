# Natter Webç®¡ç†å·¥å…· - Dockeréƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨Dockeræ¥éƒ¨ç½²å’Œè¿è¡ŒNatter Webç®¡ç†å·¥å…·ã€‚æˆ‘ä»¬æä¾›å®˜æ–¹Dockeré•œåƒï¼Œæ”¯æŒå¤šæ¶æ„ï¼ˆamd64/arm64ï¼‰ï¼Œå¯å¿«é€Ÿéƒ¨ç½²åˆ°å„ç§ç¯å¢ƒã€‚

## ç³»ç»Ÿè¦æ±‚

- Docker 19.03æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker Compose 1.27.0æˆ–æ›´é«˜ç‰ˆæœ¬
- äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºæ‹‰å–é•œåƒå’ŒNatteræœ€æ–°ä»£ç ï¼‰
- æ”¯æŒhostç½‘ç»œæ¨¡å¼çš„ç³»ç»Ÿï¼ˆLinuxæ•ˆæœæœ€ä½³ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®˜æ–¹é•œåƒï¼ˆæ¨èï¼‰

**å¿«é€Ÿå¯åŠ¨ï¼š**

```bash
# ä½¿ç”¨å®˜æ–¹é•œåƒå¿«é€Ÿéƒ¨ç½²
docker run -d --name natter-web \
  --network host \
  --cap-add NET_ADMIN \
  -v "$(pwd)/data:/app/data" \
  await2719/natter-web:latest

# è®¿é—®Webç•Œé¢
echo "ğŸŒ è®¿é—®åœ°å€: http://localhost:8080"
echo "ğŸ” é»˜è®¤å¯†ç : zd2580"
```

**ä½¿ç”¨Docker Composeï¼š**

åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š

```yaml
version: '3'
services:
  natter-web:
    image: await2719/natter-web:latest
    container_name: natter-web
    network_mode: host
    cap_add:
      - NET_ADMIN
    environment:
      - WEB_PORT=8080
      - ADMIN_PASSWORD=zd2580
      - GUEST_ENABLED=true
      - IYUU_ENABLED=true
    volumes:
      - ./data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/version"]
      interval: 30s
      timeout: 10s
      retries: 3
```

ç„¶åè¿è¡Œï¼š

```bash
docker-compose up -d
```

### æ–¹æ³•äºŒï¼šä»æºç æ„å»º

å¦‚æœæ‚¨éœ€è¦ä¿®æ”¹ä»£ç æˆ–ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ï¼š

1. æ„å»ºDockeré•œåƒï¼š

```bash
docker build -t natter-web .
```

2. è¿è¡Œå®¹å™¨ï¼š

```bash
docker run -d --name natter-web \
  --network host \
  --cap-add NET_ADMIN \
  -v "$(pwd)/data:/app/data" \
  natter-web
```

### å¯ç”¨çš„é•œåƒæ ‡ç­¾

```bash
# æœ€æ–°ç¨³å®šç‰ˆ
await2719/natter-web:latest

# ç‰¹å®šç‰ˆæœ¬
await2719/natter-web:v1.0.8
await2719/natter-web:1.0.8

# å¼€å‘ç‰ˆæœ¬
await2719/natter-web:dev
```

## æŒä¹…åŒ–æ•°æ®

**é‡è¦æç¤ºï¼šä¸€å®šè¦æ­£ç¡®æ˜ å°„æ•°æ®ç›®å½•ï¼Œå¦åˆ™æ¯æ¬¡é‡å¯å®¹å™¨æ•°æ®å°†ä¸¢å¤±**

Dockeré•œåƒä¼šå°†æ•°æ®ï¼ˆå¦‚æœåŠ¡é…ç½®å’Œæ¨¡æ¿ï¼‰å­˜å‚¨åœ¨`/app/data`ç›®å½•ä¸­ã€‚ä¸ºäº†ä¿æŒæ•°æ®æŒä¹…åŒ–ï¼Œæ‚¨å¿…é¡»å°†æ­¤ç›®å½•æŒ‚è½½åˆ°ä¸»æœºä¸Šçš„ç›®å½•ã€‚

### ä½¿ç”¨docker-composeï¼ˆæ¨èï¼‰

åœ¨docker-compose.ymlæ–‡ä»¶ä¸­å·²é…ç½®æ•°æ®æ˜ å°„ï¼š
```yaml
volumes:
  - ./data:/app/data  # æ•°æ®æŒä¹…åŒ–ï¼šå°†å®¹å™¨å†…çš„/app/dataç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºçš„./dataç›®å½•
```

è¿™ä¼šå°†æ•°æ®å­˜å‚¨åœ¨å½“å‰ç›®å½•ä¸‹çš„`data`æ–‡ä»¶å¤¹ä¸­ã€‚ç¡®ä¿è¯¥ç›®å½•åœ¨å®¿ä¸»æœºä¸Šå…·æœ‰é€‚å½“çš„æƒé™ã€‚

### ä½¿ç”¨docker runå‘½ä»¤

å¦‚æœç›´æ¥ä½¿ç”¨docker runï¼Œç¡®ä¿æ·»åŠ å·æ˜ å°„å‚æ•°ï¼š
```bash
docker run -d --name natter-web \
  --network host \
  --cap-add NET_ADMIN \
  -v "$(pwd)/data:/app/data" \
  -p 8080:8080 \
  natter-web
```

### éªŒè¯æ•°æ®æŒä¹…åŒ–

1. é¦–æ¬¡å¯åŠ¨å®¹å™¨åï¼Œä¼šåœ¨æ•°æ®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`.data_test`æ–‡ä»¶
2. é‡å¯å®¹å™¨åï¼Œå¦‚æœè¯¥æ–‡ä»¶ä»ç„¶å­˜åœ¨ï¼Œè¯´æ˜æ•°æ®ç›®å½•æ˜ å°„æ­£ç¡®
3. å¦‚æœæœåŠ¡é…ç½®å’Œæ¨¡æ¿åœ¨é‡å¯åä¸¢å¤±ï¼Œæ£€æŸ¥ï¼š
   - æ•°æ®ç›®å½•æ˜ å°„æ˜¯å¦æ­£ç¡®
   - å®¿ä¸»æœºç›®å½•æƒé™æ˜¯å¦æ­£ç¡®
   - å¯åŠ¨å‘½ä»¤ä¸­æ˜¯å¦åŒ…å«äº†å·æ˜ å°„å‚æ•°

## ç½‘ç»œé…ç½®è¯´æ˜

### ç½‘ç»œæ¨¡å¼

å®¹å™¨ä½¿ç”¨`host`ç½‘ç»œæ¨¡å¼ï¼Œè¿™å¯¹äºNatterå·¥å…·éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒéœ€è¦ç›´æ¥è®¿é—®ä¸»æœºç½‘ç»œæ¥å£æ‰èƒ½æ­£ç¡®æ£€æµ‹å’Œä½¿ç”¨NATç©¿é€åŠŸèƒ½ã€‚

### æƒé™

å®¹å™¨éœ€è¦`NET_ADMIN`æƒé™æ‰èƒ½ä½¿ç”¨iptablesç­‰ç½‘ç»œç®¡ç†å·¥å…·ã€‚è¿™æ˜¯Natterçš„æŸäº›è½¬å‘åŠŸèƒ½ï¼ˆå¦‚iptablesã€nftablesï¼‰æ‰€å¿…éœ€çš„ã€‚

## è®¿é—®æ§åˆ¶

é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebç•Œé¢å¯ä»¥é€šè¿‡`http://localhost:8080`è®¿é—®ã€‚å¦‚æœæ‚¨éœ€è¦ä»å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œè¯·ç¡®ä¿åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾8080ç«¯å£ï¼Œå¹¶æ³¨æ„æ·»åŠ é€‚å½“çš„è®¿é—®æ§åˆ¶æªæ–½ï¼Œå› ä¸ºNatterå·¥å…·å¯èƒ½ä¼šæ§åˆ¶æ‚¨çš„ç½‘ç»œè®¾ç½®ã€‚

## å¸¸è§é—®é¢˜

### å®¹å™¨æ— æ³•å¯åŠ¨

- æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºå ç”¨äº†8080ç«¯å£
- ç¡®ä¿DockeræœåŠ¡æ­£å¸¸è¿è¡Œ
- æŸ¥çœ‹Dockeræ—¥å¿—ï¼š`docker logs natter-web`

### æ— æ³•ä½¿ç”¨iptablesç­‰è½¬å‘æ–¹æ³•

- ç¡®ä¿ä½¿ç”¨äº†`--cap-add NET_ADMIN`å‚æ•°å¯åŠ¨å®¹å™¨
- å¦‚æœä½¿ç”¨Windowsæˆ–macOSï¼Œhostç½‘ç»œæ¨¡å¼å’Œç½‘ç»œç®¡ç†å·¥å…·å¯èƒ½ä¸å®Œå…¨æ”¯æŒ

### å®¹å™¨ä¸­çš„Natteræ— æ³•æ£€æµ‹åˆ°ç½‘ç»œæ¥å£

- ç¡®ä¿ä½¿ç”¨`--network host`å‚æ•°å¯åŠ¨å®¹å™¨
- åœ¨éLinuxç³»ç»Ÿä¸Šï¼Œhostç½‘ç»œæ¨¡å¼æœ‰é™åˆ¶ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œ

## è‡ªå®šä¹‰å’Œé«˜çº§é…ç½®

### ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„Natter

å¦‚æœéœ€è¦ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬çš„Natterè€Œä¸æ˜¯æœ€æ–°ç‰ˆï¼Œå¯ä»¥ä¿®æ”¹Dockerfileï¼š

```dockerfile
# å°†å…‹éš†å‘½ä»¤ä¿®æ”¹ä¸ºç‰¹å®šç‰ˆæœ¬æˆ–åˆ†æ”¯
RUN git clone -b v2.1.1 https://github.com/MikeWang000000/Natter.git /app/natter-repo
```

### è‡ªå®šä¹‰ç«¯å£

æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è‡ªå®šä¹‰Webç®¡ç†ç•Œé¢çš„ç«¯å£ï¼š

1. ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰ï¼š

```yaml
# åœ¨docker-compose.ymlä¸­
environment:
  - WEB_PORT=9090  # å°†8080ä¿®æ”¹ä¸ºä»»æ„ç«¯å£
```

æˆ–è€…åœ¨å‘½ä»¤è¡Œä¸­ï¼š

```bash
WEB_PORT=9090 docker-compose up -d
```

2. åœ¨docker runå‘½ä»¤ä¸­æŒ‡å®šç¯å¢ƒå˜é‡ï¼š

```bash
docker run -d --name natter-web \
  --network host \
  --cap-add NET_ADMIN \
  -e WEB_PORT=9090 \
  -v $(pwd)/data:/app/data \
  natter-web
```

3. é€šè¿‡å‘½ä»¤è¡Œå‚æ•°ç›´æ¥ä¼ é€’ç»™å®¹å™¨ï¼š

```bash
docker run -d --name natter-web \
  --network host \
  --cap-add NET_ADMIN \
  -v $(pwd)/data:/app/data \
  natter-web 9090
```

4. å¯¹äºä½¿ç”¨ç«¯å£æ˜ å°„ï¼ˆéhostç½‘ç»œæ¨¡å¼ï¼‰çš„é…ç½®ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹ç«¯å£æ˜ å°„ï¼š

```yaml
# åœ¨docker-compose.ymlä¸­
ports:
  - "9090:9090"  # ä¿®æ”¹ä¸ºç›¸åŒçš„è‡ªå®šä¹‰ç«¯å£
environment:
  - WEB_PORT=9090
```

### ä½¿ç”¨å·²æœ‰çš„Natterå®‰è£…

å¦‚æœæ‚¨æƒ³ä½¿ç”¨å·²æœ‰çš„Natterå®‰è£…è€Œä¸æ˜¯åœ¨å®¹å™¨ä¸­å…‹éš†æœ€æ–°ç‰ˆï¼Œå¯ä»¥å°†Natterç›®å½•æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼š

```yaml
volumes:
  - ./data:/app/data
  - /path/to/your/natter:/app/natter
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

- å®¹å™¨éœ€è¦è¾ƒé«˜çš„ç³»ç»Ÿæƒé™æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œè¯·ç¡®ä¿åœ¨å¯ä¿¡ç¯å¢ƒä¸­ä½¿ç”¨
- ä½¿ç”¨é˜²ç«å¢™é™åˆ¶å¯¹Webç®¡ç†ç•Œé¢çš„è®¿é—®
- å®šæœŸæ›´æ–°Dockeré•œåƒä»¥è·å–æœ€æ–°çš„å®‰å…¨è¡¥ä¸
