# Natter Web管理工具

这是Natter网络工具的Web管理界面，允许您通过浏览器轻松管理多个Natter服务实例。

## 功能

- 启动新的Natter服务
- 监控运行中的服务状态
- 查看服务的实时日志输出
- 停止不需要的服务
- 支持基础模式和高级模式配置
- 保存和加载配置模板
- 批量管理服务
- 详细的帮助文档和故障排除指南
- 自动重启异常终止的服务
- LAN和WAN端口可用性实时显示
- NAT类型检测与显示

## 安装依赖

Natter Web管理工具需要安装psutil库来管理进程：

```bash
pip install psutil
```

## 使用方法

### 方法一：直接运行

1. 启动Web服务器：

```bash
python server.py [端口号]
```

默认端口为8080，您可以指定其他端口。

2. 打开浏览器访问：

```
http://localhost:8080
```

### 方法二：使用Docker（推荐）

我们提供了Docker支持，方便在容器中运行Natter Web管理工具：

```bash
docker-compose up -d
```

详细的Docker使用说明请参阅[Docker文档](DOCKER.md)。

## 服务管理说明

### 基础模式

基础模式提供简化的界面，主要配置分为三个部分：

1. **基本设置**
   - 目标端口：要转发的本地端口
   - UDP模式：是否使用UDP协议
   - 转发方法：选择转发实现方式

2. **网络设置**
   - 绑定接口：网络接口名称或IP地址
   - 绑定端口：Natter服务绑定的本地端口
   - UPnP/IGD发现：尝试通过UPnP协议配置路由器

3. **高级设置**
   - STUN服务器：用于NAT类型检测的服务器
   - 保活服务器：保持NAT映射的服务器
   - 保活间隔：发送保活包的时间间隔
   - 通知脚本：当映射地址变更时执行的脚本
   - 其他选项：自动重试、映射变更时退出等

### 高级模式

高级模式允许您直接输入完整的Natter命令行参数，适合高级用户使用。您还可以保存常用配置为模板，以便快速调用。

## 模板功能

模板功能让您可以保存常用的配置，以便在需要时快速启动相同配置的服务：

1. 保存模板：
   - 从现有服务保存 - 在服务详情页面点击"保存为模板"
   - 从当前配置保存 - 点击"保存配置"按钮

2. 加载模板：
   - 点击"加载配置"按钮，选择要使用的模板

3. 管理模板：
   - 查看所有保存的模板
   - 使用或删除模板

## 状态监控

服务详情页面提供了详细的状态监控功能：

- LAN可用性：本地网络访问状态
- WAN可用性：公网访问状态
- NAT类型：当前网络的NAT类型
- 详细日志：实时更新的服务输出日志

## 批量管理

支持批量管理多个运行中的Natter服务：

- 一键刷新所有：更新所有服务的状态
- 一键停止所有：停止所有运行中的服务

## 故障排除

自动重启功能可以监控服务状态，在服务意外退出时自动重新启动，提高稳定性。

- **问题**: 服务状态显示"初始化中"但一直没变化
  **解决**: 检查natter.py路径是否正确，确保有足够权限运行

- **问题**: 无法获取映射地址
  **解决**: 等待几秒钟，Natter需要时间来获取映射地址；检查STUN服务器是否可用

- **问题**: 无法停止服务
  **解决**: 如果正常停止失败，管理工具会尝试强制终止进程

- **问题**: WAN状态显示CLOSED但本地可以访问
  **解决**: 可能是NAT类型不支持直接穿透，或者ISP阻止了特定端口的访问

## 注意事项

1. Web管理工具不会修改Natter的任何源代码
2. 所有服务管理通过进程控制实现
3. 确保Python环境中同时能够访问natter.py和server.py
4. 启用自动重启功能可能导致在某些情况下（如网络问题）持续重启循环
