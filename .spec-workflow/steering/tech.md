# 技术栈

## 项目类型
Ultrathink 是一个智能网络管理和隧道平台，包含 Web 应用程序、后端 API 服务、进程管理系统和容器化部署解决方案。主要由 Python 后端服务器和原生前端界面组成，提供实时网络监控和AI驱动的优化功能。

## 核心技术

### 主要编程语言
- **语言**: Python 3.11+
- **运行时**: CPython 3.11.8 (Docker容器中的标准运行时)
- **语言特定工具**: pip (包管理器)、psutil (进程管理)、requests (HTTP客户端)

### 核心依赖库
- **psutil**: 进程和系统监控，用于管理Natter子进程和系统资源监控
- **requests**: HTTP客户端库，用于IYUU推送服务和外部API调用
- **http.server (内置)**: 轻量级HTTP服务器，处理Web界面和API端点
- **threading (内置)**: 多线程支持，用于后台任务和并发处理
- **json (内置)**: 数据序列化，用于配置文件和API响应
- **subprocess (内置)**: 子进程管理，用于启动和控制Natter实例

### 应用架构
**单体架构 + 微服务混合模式**：
- **核心服务**: 单一 Python HTTP 服务器处理所有 Web 请求和 API 调用
- **进程管理**: 每个 Natter 服务作为独立子进程运行，实现进程级隔离
- **消息队列**: 内置批量消息处理系统，用于通知聚合和发送
- **事件驱动**: 基于线程的后台任务处理，实时监控服务状态变化

### 数据存储
- **主要存储**: 基于文件的 JSON 存储 (`web/data/` 目录)
  - `services.json`: 活跃服务实例配置和状态
  - `service_groups.json`: 用户组和权限管理
  - `iyuu_config.json`: 推送通知配置
  - `templates.json`: 配置模板存储
- **缓存**: 内存中的服务状态缓存，通过 `running_services` 字典管理
- **数据格式**: JSON 用于所有持久化数据和API通信

### 外部集成
- **APIs**: IYUU推送服务集成，支持多种消息推送方式
- **协议**:
  - HTTP/HTTPS (Web界面和API)
  - WebSocket (计划中的实时更新)
  - TCP/UDP (Natter网络隧道)
- **认证**: 基于令牌的会话认证，支持管理员和访客角色分离

### 监控与仪表板技术
- **仪表板框架**: 纯HTML5/CSS3/JavaScript，无外部依赖
- **实时通信**: HTTP轮询 (当前)，WebSocket计划中
- **可视化**: 自定义CSS样式和JavaScript交互，响应式设计
- **状态管理**: 服务器端状态管理，客户端通过API获取更新

## 开发环境

### 构建与开发工具
- **构建系统**: Docker multi-stage build + shell scripts
- **包管理**: pip (Python包)，apt (系统依赖)
- **开发工作流**: 本地开发服务器，支持热重载监控

### 代码质量工具
- **静态分析**: 依赖Python内置模块，最小化外部依赖
- **格式化**: PEP 8 Python编码标准
- **测试框架**: 计划中 (未实现)
- **文档**: 内置CLAUDE.md项目文档

### 版本控制与协作
- **VCS**: Git，支持多远程仓库推送
- **分支策略**: 基于主分支的简单工作流
- **代码审查**: 通过Git提交和合并请求

### 仪表板开发
- **实时更新**: 计划实现WebSocket实时数据流
- **端口管理**: 环境变量配置的动态端口分配
- **多实例支持**: 支持同时运行多个服务实例

## 部署与分发

- **目标平台**: Linux容器环境 (Docker)，支持x86_64和ARM64架构
- **分发方式**: Docker镜像分发，支持docker-compose一键部署
- **安装要求**:
  - Docker Engine 20.0+
  - Docker Compose 2.0+
  - 网络管理员权限 (`NET_ADMIN` capability)
- **更新机制**: Docker镜像更新，数据持久化通过volume映射

## 技术要求与约束

### 性能要求
- **响应时间**: Web界面 < 200ms，API调用 < 100ms
- **吞吐量**: 支持同时管理100+网络隧道服务
- **内存使用**: 基础运行 < 512MB，每个活跃服务额外 ~10MB
- **启动时间**: 容器启动 < 30秒，服务初始化 < 10秒

### 兼容性要求
- **平台支持**: Linux (Ubuntu 20.04+, CentOS 8+, Debian 11+)
- **架构支持**: x86_64, ARM64 (Apple Silicon, Raspberry Pi 4+)
- **Docker版本**: Engine 20.0+, Compose 2.0+
- **浏览器支持**: 现代浏览器 (Chrome 90+, Firefox 88+, Safari 14+)

### 安全与合规
- **安全要求**:
  - 基于令牌的身份验证
  - 角色分离 (管理员/访客)
  - 进程隔离和资源限制
  - 输入验证和参数清理
- **网络安全**:
  - 防止命令注入攻击
  - 安全的子进程执行
  - 最小权限原则

### 可扩展性与可靠性
- **预期负载**: 10-1000个并发服务实例，100+用户会话
- **可用性要求**: 99.9%运行时间，自动故障恢复
- **增长预测**: 支持水平扩展到多节点部署

## 技术决策与理由

### 决策日志
1. **Python单体架构**: 选择单一Python服务器而非微服务，降低部署复杂度，适合中小规模部署
2. **文件存储而非数据库**: JSON文件存储简化部署和备份，适合配置数据，无需复杂查询
3. **原生前端而非框架**: 避免外部依赖和构建复杂性，提供最大兼容性和加载性能
4. **Docker容器化**: 统一部署环境，简化依赖管理，支持跨平台部署

## 已知限制

- **单点故障**: 单体架构在服务器故障时影响全部功能，需要考虑HA方案
- **文件存储限制**: JSON文件不支持并发写入，大规模部署时可能需要迁移到数据库
- **实时更新**: 当前基于轮询，计划升级到WebSocket以减少延迟和资源消耗
- **测试覆盖**: 缺乏自动化测试框架，依赖手动测试和用户反馈