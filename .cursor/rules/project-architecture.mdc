---
description: 
globs: 
alwaysApply: false
---
# Natter Web é¡¹ç›®æ¶æ„è§„åˆ™

## ğŸ“ é¡¹ç›®ç»“æ„æ¦‚è§ˆ

```
natteer-web/
â”œâ”€â”€ ğŸ“„ [README.md](mdc:README.md)           # é¡¹ç›®ä¸»æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ [.drone.yml](mdc:.drone.yml)        # CI/CD é…ç½®
â”œâ”€â”€ ğŸ“ natter/                              # æ ¸å¿ƒNatterå·¥å…·
â”‚   â”œâ”€â”€ ğŸ“„ [natter.py](mdc:natter/natter.py) # ç½‘ç»œç©¿é€æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ ğŸ“„ [README.md](mdc:natter/README.md) # Natterå·¥å…·è¯´æ˜
â”‚   â”œâ”€â”€ ğŸ“ docs/                            # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ natter-check/                    # æ£€æŸ¥å·¥å…·
â”‚   â””â”€â”€ ğŸ“ natter-docker/                   # Dockeré…ç½®
â””â”€â”€ ğŸ“ web/                                 # Webç®¡ç†ç•Œé¢
    â”œâ”€â”€ ğŸ“„ [index.html](mdc:web/index.html)     # ä¸»ç•Œé¢
    â”œâ”€â”€ ğŸ“„ [style.css](mdc:web/style.css)       # æ ·å¼è¡¨
    â”œâ”€â”€ ğŸ“„ [script.js](mdc:web/script.js)       # å‰ç«¯é€»è¾‘
    â”œâ”€â”€ ğŸ“„ [server.py](mdc:web/server.py)       # Flaskåç«¯æœåŠ¡
    â”œâ”€â”€ ğŸ“„ [service-details-panel.html](mdc:web/service-details-panel.html) # æœåŠ¡è¯¦æƒ…ç»„ä»¶
    â”œâ”€â”€ ğŸ“„ [Dockerfile](mdc:web/Dockerfile)     # Dockeré•œåƒæ„å»º
    â”œâ”€â”€ ğŸ“„ [docker-compose.yml](mdc:web/docker-compose.yml) # å®¹å™¨ç¼–æ’
    â”œâ”€â”€ ğŸ“„ [start.sh](mdc:web/start.sh)         # å¯åŠ¨è„šæœ¬
    â””â”€â”€ ğŸ“ images/                              # é™æ€å›¾ç‰‡èµ„æº
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡æ¨¡å¼

### å‰åç«¯åˆ†ç¦»æ¶æ„
- **å‰ç«¯**: çº¯HTML+CSS+JavaScriptï¼Œæ— æ¡†æ¶ä¾èµ–
- **åç«¯**: Python Flaskæä¾›RESTful API
- **é€šä¿¡**: AJAX + JSONæ•°æ®äº¤æ¢
- **å®æ—¶æ›´æ–°**: å®šæ—¶è½®è¯¢ + WebSocketï¼ˆå¯é€‰ï¼‰

### æ ¸å¿ƒæ¨¡å—åˆ’åˆ†

#### ğŸ¨ å‰ç«¯æ¨¡å— (web/)
```javascript
// æ¨¡å—åŒ–JavaScriptç»“æ„
const NatterWeb = {
    // æœåŠ¡ç®¡ç†æ¨¡å—
    ServiceManager: {
        createService(),
        deleteService(),
        getServiceList(),
        getServiceDetails()
    },
    
    // UIç•Œé¢æ¨¡å—
    UIManager: {
        updateServiceList(),
        showServiceDetails(),
        toggleMode()
    },
    
    // é…ç½®ç®¡ç†æ¨¡å—
    ConfigManager: {
        saveTemplate(),
        loadTemplate(),
        validateConfig()
    },
    
    // é€šçŸ¥æ¨¡å—
    NotificationManager: {
        showToast(),
        sendIYUUMessage()
    }
};
```

#### ğŸ–¥ï¸ åç«¯æ¨¡å— (web/server.py)
```python
# Flaskåº”ç”¨ç»“æ„
class NatterWebServer:
    def __init__(self):
        self.service_manager = ServiceManager()
        self.config_manager = ConfigManager()
        self.notification_manager = NotificationManager()
    
    # APIè·¯ç”±
    @app.route('/api/services', methods=['GET', 'POST'])
    @app.route('/api/services/<service_id>', methods=['GET', 'DELETE'])
    @app.route('/api/templates', methods=['GET', 'POST'])
    @app.route('/api/settings', methods=['GET', 'POST'])
```

## ğŸ”§ å¼€å‘è§„èŒƒ

### Python ä»£ç è§„èŒƒ
```python
# éµå¾ªPEP 8è§„èŒƒ
import os
import json
import logging
from typing import Dict, List, Optional

class ServiceManager:
    """æœåŠ¡ç®¡ç†å™¨ - è´Ÿè´£NatteræœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†"""
    
    def __init__(self):
        self.services: Dict[str, Service] = {}
        self.logger = logging.getLogger(__name__)
    
    def create_service(self, config: Dict) -> Optional[str]:
        """åˆ›å»ºæ–°çš„NatteræœåŠ¡å®ä¾‹
        
        Args:
            config: æœåŠ¡é…ç½®å­—å…¸
            
        Returns:
            æœåŠ¡IDï¼Œå¤±è´¥æ—¶è¿”å›None
        """
        try:
            # å®ç°é€»è¾‘
            pass
        except Exception as e:
            self.logger.error(f"åˆ›å»ºæœåŠ¡å¤±è´¥: {e}")
            return None
```

### JavaScript ä»£ç è§„èŒƒ
```javascript
// ä½¿ç”¨ES6+ç°ä»£è¯­æ³•
class ServiceCard {
    constructor(serviceData) {
        this.data = serviceData;
        this.element = this.createElement();
        this.bindEvents();
    }
    
    createElement() {
        // ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ„å»ºDOM
        const template = `
            <div class="service-card" data-service-id="${this.data.id}">
                <div class="service-card__header">
                    <span class="service-card__title">${this.data.name}</span>
                    <span class="service-card__status service-card__status--${this.data.status}">
                        ${this.data.status}
                    </span>
                </div>
                <div class="service-card__content">
                    <!-- å†…å®¹åŒºåŸŸ -->
                </div>
            </div>
        `;
        
        const div = document.createElement('div');
        div.innerHTML = template;
        return div.firstElementChild;
    }
    
    bindEvents() {
        // äº‹ä»¶ç»‘å®š
        this.element.addEventListener('click', this.handleClick.bind(this));
    }
    
    async handleClick(event) {
        // å¼‚æ­¥äº‹ä»¶å¤„ç†
        try {
            const response = await fetch(`/api/services/${this.data.id}`);
            const data = await response.json();
            // å¤„ç†å“åº”
        } catch (error) {
            console.error('è·å–æœåŠ¡è¯¦æƒ…å¤±è´¥:', error);
        }
    }
}
```

### CSS ç»„ç»‡è§„èŒƒ
```css
/* ä½¿ç”¨CSSè‡ªå®šä¹‰å±æ€§ç®¡ç†ä¸»é¢˜ */
:root {
    /* é¢œè‰²ç³»ç»Ÿ */
    --color-primary: #667eea;
    --color-secondary: #764ba2;
    --color-success: #28a745;
    --color-warning: #ffc107;
    --color-error: #dc3545;
    
    /* é—´è·ç³»ç»Ÿ */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    
    /* å­—ä½“ç³»ç»Ÿ */
    --font-family-base: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-size-sm: 0.875rem;
    --font-size-base: 1rem;
    --font-size-lg: 1.125rem;
    
    /* é˜´å½±ç³»ç»Ÿ */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
}

/* BEMå‘½åè§„èŒƒ */
.service-card {
    /* å—çº§ç»„ä»¶æ ·å¼ */
}

.service-card__header {
    /* å…ƒç´ æ ·å¼ */
}

.service-card__status--active {
    /* ä¿®é¥°ç¬¦æ ·å¼ */
    color: var(--color-success);
}
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### API æ¥å£è§„èŒƒ
```http
# æœåŠ¡ç®¡ç†API
GET    /api/services           # è·å–æœåŠ¡åˆ—è¡¨
POST   /api/services           # åˆ›å»ºæ–°æœåŠ¡
GET    /api/services/{id}      # è·å–æœåŠ¡è¯¦æƒ…
DELETE /api/services/{id}      # åˆ é™¤æœåŠ¡
PUT    /api/services/{id}      # æ›´æ–°æœåŠ¡é…ç½®

# æ¨¡æ¿ç®¡ç†API
GET    /api/templates          # è·å–é…ç½®æ¨¡æ¿åˆ—è¡¨
POST   /api/templates          # ä¿å­˜æ–°æ¨¡æ¿
DELETE /api/templates/{id}     # åˆ é™¤æ¨¡æ¿

# ç³»ç»Ÿè®¾ç½®API
GET    /api/settings           # è·å–ç³»ç»Ÿè®¾ç½®
POST   /api/settings           # æ›´æ–°ç³»ç»Ÿè®¾ç½®

# å®æ—¶çŠ¶æ€API
GET    /api/status             # è·å–ç³»ç»ŸçŠ¶æ€
GET    /api/services/{id}/logs # è·å–æœåŠ¡æ—¥å¿—
```

### çŠ¶æ€ç®¡ç†
```javascript
// å‰ç«¯çŠ¶æ€ç®¡ç†
const AppState = {
    services: new Map(),
    templates: [],
    settings: {},
    currentView: 'dashboard',
    
    // çŠ¶æ€æ›´æ–°æ–¹æ³•
    updateService(serviceId, newData) {
        const service = this.services.get(serviceId);
        if (service) {
            Object.assign(service, newData);
            this.notifyObservers('service-updated', serviceId);
        }
    },
    
    // è§‚å¯Ÿè€…æ¨¡å¼
    observers: new Set(),
    addObserver(callback) {
        this.observers.add(callback);
    },
    notifyObservers(event, data) {
        this.observers.forEach(callback => callback(event, data));
    }
};
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
```python
# Pythonåç«¯æµ‹è¯• (pytest)
def test_service_creation():
    """æµ‹è¯•æœåŠ¡åˆ›å»ºåŠŸèƒ½"""
    manager = ServiceManager()
    config = {
        'target_port': 8080,
        'protocol': 'tcp',
        'bind_port': 0
    }
    service_id = manager.create_service(config)
    assert service_id is not None
    assert service_id in manager.services
```

### é›†æˆæµ‹è¯•
```javascript
// JavaScriptå‰ç«¯æµ‹è¯• (Jest)
describe('ServiceCard Component', () => {
    test('should render service information correctly', () => {
        const mockData = {
            id: 'test-service',
            name: 'Test Service',
            status: 'running'
        };
        
        const card = new ServiceCard(mockData);
        expect(card.element.querySelector('.service-card__title').textContent)
            .toBe('Test Service');
    });
});
```

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### Docker éƒ¨ç½²
```dockerfile
# å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°
FROM python:3.9-slim as builder
WORKDIR /app
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.9-slim
WORKDIR /app
COPY --from=builder /root/.local /root/.local
COPY . .
EXPOSE 8080
CMD ["python", "server.py"]
```

### ç¯å¢ƒé…ç½®
```bash
# ç¯å¢ƒå˜é‡é…ç½®
export NATTER_WEB_PORT=8080
export NATTER_WEB_HOST=0.0.0.0
export NATTER_WEB_DEBUG=false
export NATTER_DATA_DIR=/app/data
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### è¾“å…¥éªŒè¯
```python
from marshmallow import Schema, fields, validate

class ServiceConfigSchema(Schema):
    target_port = fields.Integer(required=True, validate=validate.Range(min=1, max=65535))
    protocol = fields.String(required=True, validate=validate.OneOf(['tcp', 'udp']))
    bind_port = fields.Integer(validate=validate.Range(min=0, max=65535))
```

### è®¿é—®æ§åˆ¶
```python
# APIè®¿é—®é™åˆ¶
from functools import wraps

def require_auth(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        # éªŒè¯è®¿é—®æƒé™
        if not validate_access():
            return jsonify({'error': 'Unauthorized'}), 401
        return f(*args, **kwargs)
    return decorated_function
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—é…ç½®
```python
import logging

# é…ç½®æ—¥å¿—æ ¼å¼
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('natter-web.log'),
        logging.StreamHandler()
    ]
)
```

### æ€§èƒ½ç›‘æ§
```javascript
// å‰ç«¯æ€§èƒ½ç›‘æ§
const performanceObserver = new PerformanceObserver((list) => {
    list.getEntries().forEach((entry) => {
        if (entry.entryType === 'navigation') {
            console.log('é¡µé¢åŠ è½½æ—¶é—´:', entry.loadEventEnd - entry.fetchStart);
        }
    });
});

performanceObserver.observe({ entryTypes: ['navigation'] });
```

è®°ä½ï¼šå¥½çš„æ¶æ„æ˜¯æ¼”è¿›å‡ºæ¥çš„ï¼Œä¸æ˜¯ä¸€å¼€å§‹å°±è®¾è®¡å®Œç¾çš„ã€‚ä¿æŒä»£ç ç®€æ´ã€å¯æµ‹è¯•ã€å¯ç»´æŠ¤ï¼
